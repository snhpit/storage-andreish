<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Puzzle</title>
    <script type="text/javascript" src="Scripts/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="Scripts/jquery.tmpl.js"></script>
    <link rel="stylesheet" href="Styles/puzzle.css" type="text/css">

    <script id="squareTemplate" type="text/x-jquery-tmpl">
        {{each indexes}}
            <div class="square" data-value="${$value}">
                <span>${$value}</span>
            </div>
        {{/each}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            //var context = this;
            $("#compile").click(function () { clickCompile(); });
            $("#reset").click(clickReset);
            //$(".square").click(function() { alert("dsds"); });
            $("#puzzle-box").on("click", "div", clickSquare);

            //var inputData;
            //var numberOfSquares;
            var data = { indexes: [] };

            function getNumber(inputData) {
                return Math.pow(inputData, 2);
            }

            function verifyInputData(value) {
                if (!isNaN(+value) && value > 1) {
                    return value;
                }
                return "undefined";
            }

            function numbering(numberOfSquares) {
                data.indexes.length = 0;
                for (var i = 0; i < numberOfSquares; i++) {
                    data.indexes[i] = i + 1;
                }
                data.indexes[numberOfSquares - 1] = "";
            }

            function compilePuzzleBox(sidesNumber) {
                var sizeSideSquare = 50; //$(".square").css("width"); //ещё не созданные элементы
                var borderSquareLength = 1; //$(".square").css("border-width");
                $("#puzzle-box").css("visibility", "visible");
                $("#puzzle-box").css("width", sizeSideSquare * sidesNumber + sidesNumber * borderSquareLength * 2);
                $("#puzzle-box").css("height", sizeSideSquare * sidesNumber + sidesNumber * borderSquareLength * 2);
            }

            function clickSquare() {
                var value = $(this).text();
                if (+value !== 0) {
                    // обработка
                    alert("ololo");
                }
                //var
            }

            //
            function mixing() {
                //return Math.round(Math.random() * 2 + 1);
            }

            //
            function checkEmptySquare() {
                // проверка вверху/справа/снизу/слева ?
            }

            //
            function checkOutOfRange() {

            }

            /**
             * перемещение/замена квадратов
             */

            function verifyWinningSituation() {
                var array = data.indexes;
                var lastElement = $(".square").last().text();
                if (+array[array.length - 1] === +lastElement) {
                    $(".square").each(function(i, value) {
                        if (array[i] === +$(this).text() || value === "") {
                            console.log("123");
                        }
                    });
                }
                /*
                da = { ind : [1,2,3,""] };

                 var array = da.ind;
                 var lastElement = $(".square").last().text();
                 if (+array[array.length - 1] === +lastElement) {
                 $(".square").each(function(i, value) {
                 if (array[i] === +$(this).text() || value === "") {
                 console.log("123");
                 }
                 });
                 }
                 */
            }

            /**
             * анимация
             */
            
            function clickReset() {
                $("#reset")
                    //перемешивание
            }

            function clickCompile() {

                var sidesNumber = $("#textInput").val(); //if тоже число, то и не строить
                if (verifyInputData(sidesNumber) !== "undefined") {
                    var empty = $("#puzzle-box").empty();
                    var numberOfSquares = getNumber(sidesNumber);
                    numbering(numberOfSquares);
                    compilePuzzleBox(sidesNumber);
                    $("#squareTemplate").tmpl(data).appendTo("#puzzle-box");
                }
            }
        });

    </script>
</head>
<body>
<div id="form">
    <div id="game">
        <input type="text" id="textInput"/>
        <input type="button" id="compile" value="new game"/>
        <div id="puzzle-box"></div>
        <input type="button" id="reset" value="restart game"/>
    </div>
</div>
</body>
</html>
